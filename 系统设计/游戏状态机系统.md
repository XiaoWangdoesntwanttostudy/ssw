# æ¸¸æˆçŠ¶æ€æœºç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç¼–å·**ï¼šSYS-001  
> **ç³»ç»Ÿåç§°**ï¼šæ¸¸æˆçŠ¶æ€æœºç³»ç»Ÿ  
> **æ‰€å±é¡¹ç›®**ï¼šã€Šæ·±æ¸ŠçŒæ‰‹ã€‹  
> **ç›®æ ‡å¼•æ“**ï¼šGodot 4.x  
> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
> **æ›´æ–°æ—¥æœŸ**ï¼š2025-12-02

---

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä¹‰

æ¸¸æˆçŠ¶æ€æœºç³»ç»Ÿæ˜¯æ•´ä¸ªæ¸¸æˆçš„æ ¸å¿ƒæ¡†æ¶ï¼Œè´Ÿè´£ç®¡ç†æ¸¸æˆåœ¨ä¸åŒé˜¶æ®µä¹‹é—´çš„åˆ‡æ¢ï¼ŒåŒ…æ‹¬ï¼š
- å¯åŠ¨åŠ è½½
- å®¶å›­åœºæ™¯
- å‰¯æœ¬å‡†å¤‡
- å‰¯æœ¬æ¢ç´¢
- ç»“ç®—ç•Œé¢

### 1.2 è®¾è®¡ç›®æ ‡

| ç›®æ ‡ | è¯´æ˜ |
|------|------|
| æ¸…æ™°çš„çŠ¶æ€ç®¡ç† | ä»»ä½•æ—¶åˆ»æ¸¸æˆéƒ½å¤„äºæ˜ç¡®çš„çŠ¶æ€ |
| å¹³æ»‘çš„çŠ¶æ€åˆ‡æ¢ | çŠ¶æ€ä¹‹é—´æœ‰è¿‡æ¸¡åŠ¨ç”»ï¼Œä½“éªŒæµç•… |
| æ˜“äºæ‰©å±• | æ–°å¢çŠ¶æ€ä¸å½±å“ç°æœ‰é€»è¾‘ |
| æ•°æ®å®‰å…¨ | çŠ¶æ€åˆ‡æ¢æ—¶æ­£ç¡®ä¿å­˜/åŠ è½½æ•°æ® |

### 1.3 ç³»ç»Ÿè¾¹ç•Œ

**æœ¬ç³»ç»Ÿè´Ÿè´£ï¼š**
- æ¸¸æˆçŠ¶æ€å®šä¹‰ä¸ç®¡ç†
- çŠ¶æ€åˆ‡æ¢é€»è¾‘
- åœºæ™¯åŠ è½½/å¸è½½
- çŠ¶æ€åˆ‡æ¢æ—¶çš„æ•°æ®ä¼ é€’

**æœ¬ç³»ç»Ÿä¸è´Ÿè´£ï¼š**
- å…·ä½“åœºæ™¯å†…çš„æ¸¸æˆé€»è¾‘
- UIå…·ä½“å†…å®¹ï¼ˆç”±UIç³»ç»Ÿè´Ÿè´£ï¼‰
- å­˜æ¡£è¯»å†™ç»†èŠ‚ï¼ˆç”±å­˜æ¡£ç³»ç»Ÿè´Ÿè´£ï¼‰

---

## äºŒã€çŠ¶æ€æœºè®¾è®¡

### 2.1 çŠ¶æ€å®šä¹‰

```
æ¸¸æˆä¸»çŠ¶æ€æœº
â”œâ”€â”€ BOOTï¼ˆå¯åŠ¨æ€ï¼‰
â”‚   â””â”€â”€ æ¸¸æˆå¯åŠ¨ã€èµ„æºåŠ è½½ã€å­˜æ¡£æ£€æµ‹
â”œâ”€â”€ MAIN_MENUï¼ˆä¸»èœå•æ€ï¼‰
â”‚   â””â”€â”€ å¼€å§‹æ¸¸æˆã€è®¾ç½®ã€é€€å‡º
â”œâ”€â”€ HOMEï¼ˆå®¶å›­æ€ï¼‰
â”‚   â””â”€â”€ å®¶å›­åœºæ™¯ï¼Œå»ºé€ ã€åˆ¶ä½œã€ç®¡ç†
â”œâ”€â”€ TIME_MACHINEï¼ˆæ—¶å…‰æœºæ€ï¼‰
â”‚   â””â”€â”€ è‹±é›„é€‰æ‹©ã€è£…å¤‡é…ç½®
â”œâ”€â”€ MISSION_SELECTï¼ˆå‰¯æœ¬é€‰æ‹©æ€ï¼‰
â”‚   â””â”€â”€ é€‰æ‹©å‰¯æœ¬ã€ç¡®è®¤å‡ºå‡»
â”œâ”€â”€ LOADINGï¼ˆåŠ è½½æ€ï¼‰
â”‚   â””â”€â”€ å‰¯æœ¬èµ„æºåŠ è½½
â”œâ”€â”€ MISSIONï¼ˆå‰¯æœ¬æ€ï¼‰
â”‚   â””â”€â”€ å‰¯æœ¬å†…æ¢ç´¢ã€æˆ˜æ–—ã€æ’¤ç¦»
â”œâ”€â”€ SETTLEMENTï¼ˆç»“ç®—æ€ï¼‰
â”‚   â””â”€â”€ æˆåŠŸ/å¤±è´¥ç»“ç®—
â””â”€â”€ PAUSEï¼ˆæš‚åœæ€ï¼‰
    â””â”€â”€ æš‚åœèœå•ï¼ˆå¯ä»å¤šä¸ªçŠ¶æ€è¿›å…¥ï¼‰
```

### 2.2 çŠ¶æ€æµè½¬å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     BOOT     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”‚  MAIN_MENU   â”‚â”€â”€â”€â”€â”€â”€â”€â”
            â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
            â”‚              â”‚               â”‚
            â”‚ é€€å‡ºæ¸¸æˆ     â”‚ å¼€å§‹æ¸¸æˆ      â”‚ è®¾ç½®
            â†“              â†“               â†“
          [é€€å‡º]    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   [è®¾ç½®ç•Œé¢]
                    â”‚     HOME     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“ è¿›å…¥æ—¶å…‰æœº
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ TIME_MACHINE â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“ é€‰æ‹©å‰¯æœ¬
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚MISSION_SELECTâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“ ç¡®è®¤å‡ºå‡»
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   LOADING    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   MISSION    â”‚â†â”€â”€â”
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                           â”‚           â”‚ æš‚åœ/ç»§ç»­
                           â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                           â”‚     â”‚   PAUSE   â”‚
                           â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  SETTLEMENT  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                    è¿”å› HOME
```


### 2.3 çŠ¶æ€è¯¦ç»†è¯´æ˜

#### 2.3.1 BOOTï¼ˆå¯åŠ¨æ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_BOOT` |
| è¿›å…¥æ¡ä»¶ | æ¸¸æˆå¯åŠ¨ |
| é€€å‡ºæ¡ä»¶ | èµ„æºåŠ è½½å®Œæˆ |
| ä¸‹ä¸€çŠ¶æ€ | MAIN_MENU |

**æ‰§è¡Œæµç¨‹ï¼š**
1. æ˜¾ç¤ºå¯åŠ¨Logo
2. åŠ è½½æ ¸å¿ƒèµ„æºï¼ˆé…ç½®è¡¨ã€åŸºç¡€ç´ æï¼‰
3. åˆå§‹åŒ–å„ç®¡ç†å™¨ï¼ˆéŸ³é¢‘ã€å­˜æ¡£ã€äº‹ä»¶ç­‰ï¼‰
4. æ£€æµ‹å­˜æ¡£æ˜¯å¦å­˜åœ¨
5. åˆ‡æ¢åˆ°ä¸»èœå•

#### 2.3.2 MAIN_MENUï¼ˆä¸»èœå•æ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_MAIN_MENU` |
| è¿›å…¥æ¡ä»¶ | å¯åŠ¨å®Œæˆ / ä»å®¶å›­è¿”å› |
| é€€å‡ºæ¡ä»¶ | ç‚¹å‡»å¼€å§‹/é€€å‡º |
| ä¸‹ä¸€çŠ¶æ€ | HOME / é€€å‡ºæ¸¸æˆ |

**å¯ç”¨æ“ä½œï¼š**
- ç»§ç»­æ¸¸æˆï¼ˆæœ‰å­˜æ¡£æ—¶ï¼‰
- æ–°æ¸¸æˆ
- è®¾ç½®
- é€€å‡º

#### 2.3.3 HOMEï¼ˆå®¶å›­æ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_HOME` |
| è¿›å…¥æ¡ä»¶ | ä»ä¸»èœå•è¿›å…¥ / å‰¯æœ¬ç»“ç®—åè¿”å› |
| é€€å‡ºæ¡ä»¶ | è¿›å…¥æ—¶å…‰æœº / è¿”å›ä¸»èœå• |
| ä¸‹ä¸€çŠ¶æ€ | TIME_MACHINE / MAIN_MENU |

**å¯ç”¨æ“ä½œï¼š**
- è‡ªç”±ç§»åŠ¨æ¢ç´¢å®¶å›­
- ä¸å»ºç­‘äº¤äº’ï¼ˆä»“åº“ã€å·¥åŠç­‰ï¼‰
- å»ºé€ /å‡çº§å»ºç­‘
- ç§æ¤/é‡‡é›†
- è¿›å…¥æ—¶å…‰æœº

#### 2.3.4 TIME_MACHINEï¼ˆæ—¶å…‰æœºæ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_TIME_MACHINE` |
| è¿›å…¥æ¡ä»¶ | åœ¨å®¶å›­ä¸æ—¶å…‰æœºäº¤äº’ |
| é€€å‡ºæ¡ä»¶ | é€‰æ‹©å‰¯æœ¬ / è¿”å›å®¶å›­ |
| ä¸‹ä¸€çŠ¶æ€ | MISSION_SELECT / HOME |

**å¯ç”¨æ“ä½œï¼š**
- æŸ¥çœ‹/é€‰æ‹©è‹±é›„
- è‹±é›„å…»æˆï¼ˆå‡çº§ã€æŠ€èƒ½ã€è£…å¤‡ï¼‰
- æŸ¥çœ‹è‹±é›„çŠ¶æ€ï¼ˆå†·å´ä¸­/å¯ç”¨ï¼‰
- è¿›å…¥å‰¯æœ¬é€‰æ‹©

#### 2.3.5 MISSION_SELECTï¼ˆå‰¯æœ¬é€‰æ‹©æ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_MISSION_SELECT` |
| è¿›å…¥æ¡ä»¶ | ä»æ—¶å…‰æœºè¿›å…¥ |
| é€€å‡ºæ¡ä»¶ | ç¡®è®¤å‡ºå‡» / è¿”å› |
| ä¸‹ä¸€çŠ¶æ€ | LOADING / TIME_MACHINE |

**å¯ç”¨æ“ä½œï¼š**
- é€‰æ‹©å‰¯æœ¬
- æŸ¥çœ‹å‰¯æœ¬ä¿¡æ¯ï¼ˆéš¾åº¦ã€æ‰è½ï¼‰
- é…ç½®æºå¸¦ç‰©å“
- ç¡®è®¤å‡ºå‡»

#### 2.3.6 LOADINGï¼ˆåŠ è½½æ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_LOADING` |
| è¿›å…¥æ¡ä»¶ | ç¡®è®¤å‡ºå‡» |
| é€€å‡ºæ¡ä»¶ | åŠ è½½å®Œæˆ |
| ä¸‹ä¸€çŠ¶æ€ | MISSION |

**æ‰§è¡Œæµç¨‹ï¼š**
1. æ˜¾ç¤ºåŠ è½½ç•Œé¢
2. åŠ è½½å‰¯æœ¬åœºæ™¯èµ„æº
3. ç”Ÿæˆåœ°å›¾/æ•Œäºº/ç‰©èµ„
4. åˆå§‹åŒ–ç©å®¶è§’è‰²
5. åˆ‡æ¢åˆ°å‰¯æœ¬æ€

#### 2.3.7 MISSIONï¼ˆå‰¯æœ¬æ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_MISSION` |
| è¿›å…¥æ¡ä»¶ | åŠ è½½å®Œæˆ |
| é€€å‡ºæ¡ä»¶ | æ’¤ç¦»æˆåŠŸ / æ­»äº¡ / ä¾µèš€åº¦æ»¡ |
| ä¸‹ä¸€çŠ¶æ€ | SETTLEMENT |

**å­çŠ¶æ€ï¼š**
- EXPLORINGï¼ˆæ¢ç´¢ä¸­ï¼‰
- COMBATï¼ˆæˆ˜æ–—ä¸­ï¼‰
- EVACUATINGï¼ˆæ’¤ç¦»ä¸­ï¼‰
- DEADï¼ˆæ­»äº¡ï¼‰

#### 2.3.8 SETTLEMENTï¼ˆç»“ç®—æ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_SETTLEMENT` |
| è¿›å…¥æ¡ä»¶ | å‰¯æœ¬ç»“æŸ |
| é€€å‡ºæ¡ä»¶ | ç‚¹å‡»ç¡®è®¤ |
| ä¸‹ä¸€çŠ¶æ€ | HOME |

**æ˜¾ç¤ºå†…å®¹ï¼š**
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- è·å¾—/æŸå¤±ç‰©èµ„
- è‹±é›„ç»éªŒè·å–
- è‹±é›„çŠ¶æ€å˜åŒ–

#### 2.3.9 PAUSEï¼ˆæš‚åœæ€ï¼‰

| å±æ€§ | å€¼ |
|------|-----|
| çŠ¶æ€ID | `STATE_PAUSE` |
| è¿›å…¥æ¡ä»¶ | æŒ‰ESCé”®ï¼ˆåœ¨HOME/MISSIONçŠ¶æ€ï¼‰ |
| é€€å‡ºæ¡ä»¶ | ç»§ç»­/è¿”å›ä¸»èœå• |
| ä¸‹ä¸€çŠ¶æ€ | è¿”å›ä¹‹å‰çŠ¶æ€ / MAIN_MENU |

**å¯ç”¨æ“ä½œï¼š**
- ç»§ç»­æ¸¸æˆ
- è®¾ç½®
- è¿”å›ä¸»èœå•ï¼ˆå‰¯æœ¬ä¸­ä¼šè­¦å‘Šä¸¢å¤±è¿›åº¦ï¼‰

---

## ä¸‰ã€Godot å®ç°æ–¹æ¡ˆ

### 3.1 é¡¹ç›®ç»“æ„

```
project/
â”œâ”€â”€ autoload/                    # è‡ªåŠ¨åŠ è½½ï¼ˆå…¨å±€å•ä¾‹ï¼‰
â”‚   â”œâ”€â”€ GameManager.gd          # æ¸¸æˆçŠ¶æ€æœºä¸»ç®¡ç†å™¨
â”‚   â”œâ”€â”€ SceneManager.gd         # åœºæ™¯åŠ è½½ç®¡ç†å™¨
â”‚   â”œâ”€â”€ EventBus.gd             # å…¨å±€äº‹ä»¶æ€»çº¿
â”‚   â””â”€â”€ SaveManager.gd          # å­˜æ¡£ç®¡ç†å™¨
â”œâ”€â”€ scenes/
â”‚   â”œâ”€â”€ boot/
â”‚   â”‚   â””â”€â”€ BootScene.tscn      # å¯åŠ¨åœºæ™¯
â”‚   â”œâ”€â”€ main_menu/
â”‚   â”‚   â””â”€â”€ MainMenuScene.tscn  # ä¸»èœå•åœºæ™¯
â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â””â”€â”€ HomeScene.tscn      # å®¶å›­åœºæ™¯
â”‚   â”œâ”€â”€ time_machine/
â”‚   â”‚   â””â”€â”€ TimeMachineUI.tscn  # æ—¶å…‰æœºç•Œé¢
â”‚   â”œâ”€â”€ mission_select/
â”‚   â”‚   â””â”€â”€ MissionSelectUI.tscn # å‰¯æœ¬é€‰æ‹©ç•Œé¢
â”‚   â”œâ”€â”€ mission/
â”‚   â”‚   â””â”€â”€ MissionScene.tscn   # å‰¯æœ¬åœºæ™¯æ¨¡æ¿
â”‚   â”œâ”€â”€ settlement/
â”‚   â”‚   â””â”€â”€ SettlementUI.tscn   # ç»“ç®—ç•Œé¢
â”‚   â””â”€â”€ loading/
â”‚       â””â”€â”€ LoadingScreen.tscn  # åŠ è½½ç•Œé¢
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ state_machine/
â”‚   â”‚   â”œâ”€â”€ GameState.gd        # çŠ¶æ€åŸºç±»
â”‚   â”‚   â”œâ”€â”€ BootState.gd        # å¯åŠ¨çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ MainMenuState.gd    # ä¸»èœå•çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ HomeState.gd        # å®¶å›­çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ TimeMachineState.gd # æ—¶å…‰æœºçŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ MissionSelectState.gd # å‰¯æœ¬é€‰æ‹©çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ LoadingState.gd     # åŠ è½½çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ MissionState.gd     # å‰¯æœ¬çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ SettlementState.gd  # ç»“ç®—çŠ¶æ€
â”‚   â”‚   â””â”€â”€ PauseState.gd       # æš‚åœçŠ¶æ€
â”‚   â””â”€â”€ data/
â”‚       â””â”€â”€ GameStateData.gd    # çŠ¶æ€é—´ä¼ é€’çš„æ•°æ®
â””â”€â”€ resources/
    â””â”€â”€ state_config.tres       # çŠ¶æ€é…ç½®èµ„æº
```


### 3.2 æ ¸å¿ƒä»£ç è®¾è®¡

#### 3.2.1 çŠ¶æ€æšä¸¾å®šä¹‰

```gdscript
# GameManager.gd
extends Node

enum GameState {
    BOOT,
    MAIN_MENU,
    HOME,
    TIME_MACHINE,
    MISSION_SELECT,
    LOADING,
    MISSION,
    SETTLEMENT,
    PAUSE
}

var current_state: GameState = GameState.BOOT
var previous_state: GameState = GameState.BOOT
var state_handlers: Dictionary = {}
```

#### 3.2.2 çŠ¶æ€åŸºç±»

```gdscript
# scripts/state_machine/GameState.gd
class_name BaseGameState
extends RefCounted

var game_manager: Node

func _init(manager: Node) -> void:
    game_manager = manager

# è¿›å…¥çŠ¶æ€æ—¶è°ƒç”¨
func enter(data: Dictionary = {}) -> void:
    pass

# é€€å‡ºçŠ¶æ€æ—¶è°ƒç”¨
func exit() -> void:
    pass

# æ¯å¸§æ›´æ–°ï¼ˆå¯é€‰ï¼‰
func update(delta: float) -> void:
    pass

# å¤„ç†è¾“å…¥ï¼ˆå¯é€‰ï¼‰
func handle_input(event: InputEvent) -> void:
    pass
```

#### 3.2.3 æ¸¸æˆç®¡ç†å™¨

```gdscript
# autoload/GameManager.gd
extends Node

signal state_changed(from_state, to_state)

enum GameState { BOOT, MAIN_MENU, HOME, TIME_MACHINE, 
                 MISSION_SELECT, LOADING, MISSION, SETTLEMENT, PAUSE }

var current_state: GameState = GameState.BOOT
var previous_state: GameState = GameState.BOOT
var _state_handlers: Dictionary = {}
var _current_handler: BaseGameState = null

# çŠ¶æ€åˆ‡æ¢æ—¶ä¼ é€’çš„æ•°æ®
var transition_data: Dictionary = {}

func _ready() -> void:
    _init_state_handlers()
    change_state(GameState.BOOT)

func _init_state_handlers() -> void:
    _state_handlers[GameState.BOOT] = BootState.new(self)
    _state_handlers[GameState.MAIN_MENU] = MainMenuState.new(self)
    _state_handlers[GameState.HOME] = HomeState.new(self)
    _state_handlers[GameState.TIME_MACHINE] = TimeMachineState.new(self)
    _state_handlers[GameState.MISSION_SELECT] = MissionSelectState.new(self)
    _state_handlers[GameState.LOADING] = LoadingState.new(self)
    _state_handlers[GameState.MISSION] = MissionState.new(self)
    _state_handlers[GameState.SETTLEMENT] = SettlementState.new(self)
    _state_handlers[GameState.PAUSE] = PauseState.new(self)

func change_state(new_state: GameState, data: Dictionary = {}) -> void:
    if _current_handler:
        _current_handler.exit()
    
    previous_state = current_state
    current_state = new_state
    transition_data = data
    
    _current_handler = _state_handlers.get(new_state)
    if _current_handler:
        _current_handler.enter(data)
    
    state_changed.emit(previous_state, current_state)

func _process(delta: float) -> void:
    if _current_handler:
        _current_handler.update(delta)

func _input(event: InputEvent) -> void:
    if _current_handler:
        _current_handler.handle_input(event)
    
    # å…¨å±€æš‚åœå¤„ç†
    if event.is_action_pressed("pause"):
        if current_state == GameState.PAUSE:
            change_state(previous_state)
        elif current_state in [GameState.HOME, GameState.MISSION]:
            change_state(GameState.PAUSE)
```

#### 3.2.4 åœºæ™¯ç®¡ç†å™¨

```gdscript
# autoload/SceneManager.gd
extends Node

signal scene_loaded(scene_name)
signal loading_progress(progress)

var _current_scene: Node = null
var _loading_screen: Control = null

const SCENES = {
    "boot": "res://scenes/boot/BootScene.tscn",
    "main_menu": "res://scenes/main_menu/MainMenuScene.tscn",
    "home": "res://scenes/home/HomeScene.tscn",
    "mission": "res://scenes/mission/MissionScene.tscn",
}

func load_scene(scene_key: String, show_loading: bool = true) -> void:
    if show_loading:
        _show_loading_screen()
    
    var scene_path = SCENES.get(scene_key, "")
    if scene_path.is_empty():
        push_error("Scene not found: " + scene_key)
        return
    
    # å¼‚æ­¥åŠ è½½
    ResourceLoader.load_threaded_request(scene_path)
    await _wait_for_load(scene_path)
    
    var scene_resource = ResourceLoader.load_threaded_get(scene_path)
    _switch_scene(scene_resource)
    
    if show_loading:
        _hide_loading_screen()
    
    scene_loaded.emit(scene_key)

func _wait_for_load(path: String) -> void:
    var progress = []
    while true:
        var status = ResourceLoader.load_threaded_get_status(path, progress)
        loading_progress.emit(progress[0] if progress.size() > 0 else 0.0)
        
        if status == ResourceLoader.THREAD_LOAD_LOADED:
            break
        elif status == ResourceLoader.THREAD_LOAD_FAILED:
            push_error("Failed to load scene: " + path)
            break
        
        await get_tree().process_frame

func _switch_scene(scene_resource: PackedScene) -> void:
    if _current_scene:
        _current_scene.queue_free()
    
    _current_scene = scene_resource.instantiate()
    get_tree().root.add_child(_current_scene)

func _show_loading_screen() -> void:
    if not _loading_screen:
        var loading_scene = load("res://scenes/loading/LoadingScreen.tscn")
        _loading_screen = loading_scene.instantiate()
    get_tree().root.add_child(_loading_screen)

func _hide_loading_screen() -> void:
    if _loading_screen:
        _loading_screen.queue_free()
        _loading_screen = null
```


#### 3.2.5 å…·ä½“çŠ¶æ€å®ç°ç¤ºä¾‹

```gdscript
# scripts/state_machine/HomeState.gd
class_name HomeState
extends BaseGameState

func enter(data: Dictionary = {}) -> void:
    # åŠ è½½å®¶å›­åœºæ™¯
    SceneManager.load_scene("home")
    
    # æ’­æ”¾å®¶å›­BGM
    AudioManager.play_bgm("home_bgm")
    
    # å¦‚æœæ˜¯ä»å‰¯æœ¬è¿”å›ï¼Œå¤„ç†ç»“ç®—æ•°æ®
    if data.has("from_mission"):
        _handle_mission_return(data)

func exit() -> void:
    # è‡ªåŠ¨å­˜æ¡£
    SaveManager.save_game()

func handle_input(event: InputEvent) -> void:
    # Eé”®ä¸æ—¶å…‰æœºäº¤äº’
    if event.is_action_pressed("interact"):
        var interactable = _get_nearby_interactable()
        if interactable and interactable.type == "time_machine":
            game_manager.change_state(GameManager.GameState.TIME_MACHINE)

func _handle_mission_return(data: Dictionary) -> void:
    # å¤„ç†å‰¯æœ¬è¿”å›çš„æ•°æ®
    if data.get("success", false):
        # ç‰©èµ„å…¥åº“
        InventoryManager.add_items(data.get("loot", []))
    # æ›´æ–°è‹±é›„çŠ¶æ€
    HeroManager.update_hero_status(data.get("hero_id"), data.get("hero_status"))
```

```gdscript
# scripts/state_machine/MissionState.gd
class_name MissionState
extends BaseGameState

enum SubState { EXPLORING, COMBAT, EVACUATING, DEAD }
var sub_state: SubState = SubState.EXPLORING

var mission_data: Dictionary = {}
var collected_loot: Array = []
var corrosion: float = 0.0

func enter(data: Dictionary = {}) -> void:
    mission_data = data
    collected_loot = []
    corrosion = 0.0
    sub_state = SubState.EXPLORING
    
    # åœºæ™¯å·²åœ¨LOADINGçŠ¶æ€åŠ è½½å®Œæˆ
    AudioManager.play_bgm(data.get("bgm", "mission_bgm"))

func update(delta: float) -> void:
    # æ›´æ–°ä¾µèš€åº¦
    _update_corrosion(delta)
    
    # æ£€æŸ¥ç»“æŸæ¡ä»¶
    _check_end_conditions()

func _update_corrosion(delta: float) -> void:
    corrosion += delta * 0.083  # æ¯åˆ†é’Ÿ+5%
    corrosion = clamp(corrosion, 0.0, 100.0)
    
    # å‘é€ä¾µèš€åº¦æ›´æ–°äº‹ä»¶
    EventBus.emit_signal("corrosion_updated", corrosion)

func _check_end_conditions() -> void:
    if corrosion >= 100.0:
        _end_mission(false, "corrosion")
    # å…¶ä»–ç»“æŸæ¡ä»¶ç”±äº‹ä»¶è§¦å‘

func _end_mission(success: bool, reason: String) -> void:
    var result_data = {
        "success": success,
        "reason": reason,
        "loot": collected_loot if success else [],
        "hero_id": mission_data.get("hero_id"),
        "hero_status": _calculate_hero_status(success, reason),
        "exp_gained": _calculate_exp(success)
    }
    game_manager.change_state(GameManager.GameState.SETTLEMENT, result_data)

func on_evacuation_complete() -> void:
    _end_mission(true, "evacuated")

func on_player_dead() -> void:
    _end_mission(false, "dead")

func _calculate_hero_status(success: bool, reason: String) -> String:
    if success:
        return "normal"
    elif reason == "dead":
        return "heavy_injured"  # é‡ä¼¤
    else:
        return "light_injured"  # è½»ä¼¤
```

### 3.3 äº‹ä»¶æ€»çº¿

```gdscript
# autoload/EventBus.gd
extends Node

# çŠ¶æ€æœºç›¸å…³
signal state_change_requested(new_state, data)

# å‰¯æœ¬ç›¸å…³
signal corrosion_updated(value)
signal evacuation_started()
signal evacuation_completed()
signal evacuation_interrupted()
signal player_died()
signal loot_collected(item)

# å®¶å›­ç›¸å…³
signal building_placed(building_data)
signal resource_collected(resource_type, amount)

# è‹±é›„ç›¸å…³
signal hero_selected(hero_id)
signal hero_status_changed(hero_id, status)
```

---

## å››ã€UI ç•Œé¢è®¾è®¡

### 4.1 ç•Œé¢åˆ—è¡¨

| ç•Œé¢ID | ç•Œé¢åç§° | æ‰€å±çŠ¶æ€ | ç±»å‹ |
|--------|----------|----------|------|
| UI_Boot | å¯åŠ¨ç•Œé¢ | BOOT | å…¨å± |
| UI_MainMenu | ä¸»èœå• | MAIN_MENU | å…¨å± |
| UI_HomeHUD | å®¶å›­HUD | HOME | å åŠ å±‚ |
| UI_TimeMachine | æ—¶å…‰æœºç•Œé¢ | TIME_MACHINE | å…¨å± |
| UI_MissionSelect | å‰¯æœ¬é€‰æ‹© | MISSION_SELECT | å…¨å± |
| UI_Loading | åŠ è½½ç•Œé¢ | LOADING | å…¨å± |
| UI_MissionHUD | å‰¯æœ¬HUD | MISSION | å åŠ å±‚ |
| UI_Settlement | ç»“ç®—ç•Œé¢ | SETTLEMENT | å…¨å± |
| UI_Pause | æš‚åœèœå• | PAUSE | å¼¹çª— |

### 4.2 ç•Œé¢çº¿æ¡†å›¾

#### 4.2.1 ä¸»èœå•ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                    ã€Šæ·±æ¸ŠçŒæ‰‹ã€‹                              â”‚
â”‚                    ABYSS HUNTER                             â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚    ç»§ç»­æ¸¸æˆ     â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚    æ–°çš„å¼€å§‹     â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚      è®¾ç½®      â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚    é€€å‡ºæ¸¸æˆ     â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                             â”‚
â”‚                                           v1.0.0            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.2 å®¶å›­HUD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ èµ„æºæ˜¾ç¤º     â”‚                        â”‚    å°åœ°å›¾      â”‚ â”‚
â”‚ â”‚ ğŸªµ æœ¨æ: 150 â”‚                        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ ğŸª¨ çŸ³æ: 80  â”‚                        â”‚   â”‚ Â· â–² Â· â”‚   â”‚ â”‚
â”‚ â”‚ ğŸ”© é“çŸ¿: 45  â”‚                        â”‚   â”‚ Â· Â· Â· â”‚   â”‚ â”‚
â”‚ â”‚ ğŸ’° é‡‘å¸: 1200â”‚                        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                     ã€æ¸¸æˆç”»é¢åŒºåŸŸã€‘                         â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [E] äº¤äº’                              [Tab] èƒŒåŒ…  [Esc] èœå•â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.3 å‰¯æœ¬HUD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  â”‚                   â”‚    å°åœ°å›¾       â”‚ â”‚
â”‚ â”‚ æŠ¤ç›¾ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ â”‚                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚ â”‚ è€åŠ› â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  â”‚                   â”‚   â”‚ Â· â–² Â· â”‚    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚ Â· Â· E â”‚    â”‚ â”‚
â”‚                                         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  E=æ’¤ç¦»ç‚¹      â”‚ â”‚
â”‚ â”‚ ä¾µèš€åº¦: 35%      â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚                                       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                             â”‚
â”‚                     ã€æ¸¸æˆç”»é¢åŒºåŸŸã€‘                         â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚æŠ€èƒ½1 â”‚â”‚æŠ€èƒ½2 â”‚â”‚æŠ€èƒ½3 â”‚â”‚æŠ€èƒ½4 â”‚    â”‚ [1]è¯æ°´ [2]å¼¹è¯   â”‚â”‚
â”‚ â”‚  Q   â”‚â”‚  E   â”‚â”‚  R   â”‚â”‚  F   â”‚    â”‚ [3]ä¿¡å·å¼¹ [4]ç©º   â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚ [Tab]èƒŒåŒ…  [M]åœ°å›¾  [Esc]æš‚åœ                 å¼¹è¯: 30/120  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


#### 4.2.4 ç»“ç®—ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚                    âœ“ æ’¤ç¦»æˆåŠŸï¼ / âœ— ä»»åŠ¡å¤±è´¥                â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ä»»åŠ¡æŠ¥å‘Š                           â”‚
â”‚  â”‚                 â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  â”‚   [è‹±é›„ç«‹ç»˜]    â”‚    è‹±é›„ï¼šçŒäºº Lv.15                    â”‚
â”‚  â”‚                 â”‚    å‰¯æœ¬ï¼šåºŸå¼ƒå·¥å‚                      â”‚
â”‚  â”‚                 â”‚    ç”¨æ—¶ï¼š12:34                        â”‚
â”‚  â”‚                 â”‚    ä¾µèš€åº¦ï¼š35%                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·å¾—ç‰©èµ„                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”              â”‚
â”‚  â”‚é“çŸ¿â”‚ â”‚æœ¨æâ”‚ â”‚å¸ƒæ–™â”‚ â”‚å¼¹è¯â”‚ â”‚æ­¥æªâ”‚ â”‚é‡‘å¸â”‚              â”‚
â”‚  â”‚x10 â”‚ â”‚x15 â”‚ â”‚x8  â”‚ â”‚x60 â”‚ â”‚x1  â”‚ â”‚320 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚  æ€»ä»·å€¼ï¼šçº¦ 1,850 é‡‘å¸                                      â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è‹±é›„çŠ¶æ€                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚  ç»éªŒè·å¾—ï¼š+450 EXP    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ (72%)          â”‚
â”‚  çŠ¶æ€ï¼šæ­£å¸¸ / è½»ä¼¤(1å°æ—¶å†·å´) / é‡ä¼¤(4å°æ—¶å†·å´)            â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                      [ è¿”å›å®¶å›­ ]                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€ç¾æœ¯èµ„æºéœ€æ±‚

### 5.1 UI ç¾æœ¯èµ„æº

#### 5.1.1 ç•Œé¢èƒŒæ™¯

| èµ„æºåç§° | å°ºå¯¸ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|----------|------|------|--------|
| bg_main_menu | 1920x1080 | ä¸»èœå•èƒŒæ™¯ï¼ˆå¼‚ç©ºé—´æ¦‚å¿µå›¾ï¼‰ | P0 |
| bg_loading | 1920x1080 | åŠ è½½ç•Œé¢èƒŒæ™¯ï¼ˆå¤šå¥—ï¼ŒæŒ‰å‰¯æœ¬ï¼‰ | P0 |
| bg_settlement_success | 1920x1080 | æˆåŠŸç»“ç®—èƒŒæ™¯ | P1 |
| bg_settlement_fail | 1920x1080 | å¤±è´¥ç»“ç®—èƒŒæ™¯ | P1 |
| bg_time_machine | 1920x1080 | æ—¶å…‰æœºç•Œé¢èƒŒæ™¯ | P1 |

#### 5.1.2 UI ç»„ä»¶

| èµ„æºåç§° | è§„æ ¼ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|----------|------|------|--------|
| panel_common | ä¹å®«æ ¼ | é€šç”¨é¢æ¿åº•å›¾ | P0 |
| btn_primary | 200x60 | ä¸»æŒ‰é’®ï¼ˆæ™®é€š/æ‚¬åœ/æŒ‰ä¸‹/ç¦ç”¨ï¼‰ | P0 |
| btn_secondary | 200x60 | æ¬¡æŒ‰é’® | P0 |
| btn_danger | 200x60 | å±é™©æŒ‰é’®ï¼ˆçº¢è‰²ç³»ï¼‰ | P1 |
| progress_hp | å¯æ‹‰ä¼¸ | è¡€æ¡ | P0 |
| progress_shield | å¯æ‹‰ä¼¸ | æŠ¤ç›¾æ¡ | P0 |
| progress_stamina | å¯æ‹‰ä¼¸ | è€åŠ›æ¡ | P0 |
| progress_corrosion | å¯æ‹‰ä¼¸ | ä¾µèš€åº¦æ¡ï¼ˆç´«è‰²ç³»ï¼‰ | P0 |
| progress_exp | å¯æ‹‰ä¼¸ | ç»éªŒæ¡ | P1 |
| progress_loading | å¯æ‹‰ä¼¸ | åŠ è½½è¿›åº¦æ¡ | P0 |
| slot_item | 64x64 | ç‰©å“æ ¼å­ | P0 |
| slot_skill | 64x64 | æŠ€èƒ½æ ¼å­ | P0 |
| slot_equipment | 80x80 | è£…å¤‡æ ¼å­ | P1 |
| frame_hero | 120x160 | è‹±é›„å¡ç‰‡è¾¹æ¡† | P1 |
| frame_mission | 200x150 | å‰¯æœ¬é€‰æ‹©å¡ç‰‡è¾¹æ¡† | P1 |

#### 5.1.3 å›¾æ ‡

| ç±»å‹ | æ•°é‡ | è§„æ ¼ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|------|------|--------|
| èµ„æºå›¾æ ‡ | 10+ | 32x32 | æœ¨æ/çŸ³æ/é“çŸ¿/é‡‘å¸ç­‰ | P0 |
| çŠ¶æ€å›¾æ ‡ | 20+ | 32x32 | Buff/Debuffå›¾æ ‡ | P1 |
| åŠŸèƒ½å›¾æ ‡ | 15+ | 48x48 | èƒŒåŒ…/åœ°å›¾/è®¾ç½®ç­‰ | P0 |
| è‹±é›„çŠ¶æ€å›¾æ ‡ | 5 | 32x32 | æ­£å¸¸/è½»ä¼¤/é‡ä¼¤/æ¿’æ­»/å†·å´ | P1 |

### 5.2 è¿‡æ¸¡åŠ¨ç”»èµ„æº

| èµ„æºåç§° | ç±»å‹ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|----------|------|------|--------|
| transition_fade | åŠ¨ç”» | æ·¡å…¥æ·¡å‡ºè¿‡æ¸¡ | P0 |
| transition_wipe | åŠ¨ç”» | æ“¦é™¤è¿‡æ¸¡ | P2 |
| transition_portal | åŠ¨ç”» | æ—¶å…‰æœºä¼ é€ç‰¹æ•ˆ | P1 |
| loading_spinner | åŠ¨ç”» | åŠ è½½æ—‹è½¬åŠ¨ç”» | P0 |
| loading_tips | æ–‡æœ¬ | åŠ è½½æç¤ºæ–‡å­—ï¼ˆå¤šæ¡ï¼‰ | P1 |

### 5.3 éŸ³é¢‘èµ„æº

#### 5.3.1 èƒŒæ™¯éŸ³ä¹

| éŸ³ä¹ID | åœºæ™¯ | é£æ ¼ | æ—¶é•¿ | ä¼˜å…ˆçº§ |
|--------|------|------|------|--------|
| bgm_main_menu | ä¸»èœå• | ç¥ç§˜/å²è¯— | 2-3åˆ†é’Ÿ | P0 |
| bgm_home | å®¶å›­ | æ¸©æš–/æ”¾æ¾ | 3-4åˆ†é’Ÿ | P0 |
| bgm_time_machine | æ—¶å…‰æœº | ç§‘å¹»/ç¥ç§˜ | 2-3åˆ†é’Ÿ | P1 |
| bgm_mission_factory | åºŸå¼ƒå·¥å‚ | ç´§å¼ /å·¥ä¸š | 3-4åˆ†é’Ÿ | P0 |
| bgm_mission_forest | å¹½æš—æ£®æ— | è¯¡å¼‚/è‡ªç„¶ | 3-4åˆ†é’Ÿ | P1 |
| bgm_settlement_success | æˆåŠŸç»“ç®— | æ¬¢å¿«/æˆå°± | 1åˆ†é’Ÿ | P1 |
| bgm_settlement_fail | å¤±è´¥ç»“ç®— | ä½æ²‰/æ‚²ä¼¤ | 1åˆ†é’Ÿ | P1 |

#### 5.3.2 éŸ³æ•ˆ

| éŸ³æ•ˆID | è§¦å‘ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|--------|------|------|--------|
| sfx_ui_click | UIç‚¹å‡» | æŒ‰é’®ç‚¹å‡»éŸ³ | P0 |
| sfx_ui_hover | UIæ‚¬åœ | æŒ‰é’®æ‚¬åœéŸ³ | P1 |
| sfx_ui_open | ç•Œé¢æ‰“å¼€ | é¢æ¿æ‰“å¼€éŸ³ | P0 |
| sfx_ui_close | ç•Œé¢å…³é—­ | é¢æ¿å…³é—­éŸ³ | P0 |
| sfx_state_change | çŠ¶æ€åˆ‡æ¢ | çŠ¶æ€åˆ‡æ¢æç¤ºéŸ³ | P1 |
| sfx_portal_enter | è¿›å…¥æ—¶å…‰æœº | ä¼ é€é—¨éŸ³æ•ˆ | P1 |
| sfx_portal_exit | ç¦»å¼€æ—¶å…‰æœº | ä¼ é€å®ŒæˆéŸ³æ•ˆ | P1 |
| sfx_evacuation_start | å¼€å§‹æ’¤ç¦» | æ’¤ç¦»å¼€å§‹éŸ³ | P0 |
| sfx_evacuation_tick | æ’¤ç¦»å€’è®¡æ—¶ | å€’è®¡æ—¶æ»´ç­”å£° | P0 |
| sfx_evacuation_success | æ’¤ç¦»æˆåŠŸ | æˆåŠŸéŸ³æ•ˆ | P0 |
| sfx_corrosion_warning | ä¾µèš€åº¦è­¦å‘Š | è­¦å‘ŠéŸ³ï¼ˆ50%/75%æ—¶ï¼‰ | P0 |

---

## å…­ã€é…ç½®è¡¨è®¾è®¡

### 6.1 çŠ¶æ€é…ç½®è¡¨ï¼ˆstate_config.jsonï¼‰

```json
{
  "states": [
    {
      "id": "BOOT",
      "name": "å¯åŠ¨æ€",
      "scene": "",
      "bgm": "",
      "allow_pause": false,
      "auto_save": false
    },
    {
      "id": "MAIN_MENU",
      "name": "ä¸»èœå•",
      "scene": "res://scenes/main_menu/MainMenuScene.tscn",
      "bgm": "bgm_main_menu",
      "allow_pause": false,
      "auto_save": false
    },
    {
      "id": "HOME",
      "name": "å®¶å›­",
      "scene": "res://scenes/home/HomeScene.tscn",
      "bgm": "bgm_home",
      "allow_pause": true,
      "auto_save": true
    },
    {
      "id": "TIME_MACHINE",
      "name": "æ—¶å…‰æœº",
      "scene": "",
      "ui": "res://scenes/time_machine/TimeMachineUI.tscn",
      "bgm": "bgm_time_machine",
      "allow_pause": true,
      "auto_save": false
    },
    {
      "id": "MISSION_SELECT",
      "name": "å‰¯æœ¬é€‰æ‹©",
      "scene": "",
      "ui": "res://scenes/mission_select/MissionSelectUI.tscn",
      "bgm": "bgm_time_machine",
      "allow_pause": true,
      "auto_save": false
    },
    {
      "id": "LOADING",
      "name": "åŠ è½½ä¸­",
      "scene": "",
      "ui": "res://scenes/loading/LoadingScreen.tscn",
      "bgm": "",
      "allow_pause": false,
      "auto_save": false
    },
    {
      "id": "MISSION",
      "name": "å‰¯æœ¬",
      "scene": "dynamic",
      "bgm": "dynamic",
      "allow_pause": true,
      "auto_save": false
    },
    {
      "id": "SETTLEMENT",
      "name": "ç»“ç®—",
      "scene": "",
      "ui": "res://scenes/settlement/SettlementUI.tscn",
      "bgm": "dynamic",
      "allow_pause": false,
      "auto_save": true
    },
    {
      "id": "PAUSE",
      "name": "æš‚åœ",
      "scene": "",
      "ui": "res://scenes/pause/PauseMenu.tscn",
      "bgm": "",
      "allow_pause": false,
      "auto_save": false
    }
  ]
}
```

### 6.2 çŠ¶æ€è½¬æ¢é…ç½®è¡¨ï¼ˆstate_transitions.jsonï¼‰

```json
{
  "transitions": [
    { "from": "BOOT", "to": "MAIN_MENU", "trigger": "auto", "condition": "load_complete" },
    { "from": "MAIN_MENU", "to": "HOME", "trigger": "button", "condition": "has_save" },
    { "from": "MAIN_MENU", "to": "HOME", "trigger": "button", "condition": "new_game" },
    { "from": "HOME", "to": "TIME_MACHINE", "trigger": "interact", "condition": "near_time_machine" },
    { "from": "HOME", "to": "MAIN_MENU", "trigger": "button", "condition": "" },
    { "from": "TIME_MACHINE", "to": "HOME", "trigger": "button", "condition": "" },
    { "from": "TIME_MACHINE", "to": "MISSION_SELECT", "trigger": "button", "condition": "hero_selected" },
    { "from": "MISSION_SELECT", "to": "TIME_MACHINE", "trigger": "button", "condition": "" },
    { "from": "MISSION_SELECT", "to": "LOADING", "trigger": "button", "condition": "mission_selected" },
    { "from": "LOADING", "to": "MISSION", "trigger": "auto", "condition": "load_complete" },
    { "from": "MISSION", "to": "SETTLEMENT", "trigger": "event", "condition": "mission_end" },
    { "from": "SETTLEMENT", "to": "HOME", "trigger": "button", "condition": "" },
    { "from": "HOME", "to": "PAUSE", "trigger": "input", "condition": "pause_key" },
    { "from": "MISSION", "to": "PAUSE", "trigger": "input", "condition": "pause_key" },
    { "from": "PAUSE", "to": "previous", "trigger": "button", "condition": "" }
  ]
}
```

---

## ä¸ƒã€æµ‹è¯•è¦ç‚¹

### 7.1 åŠŸèƒ½æµ‹è¯•

| æµ‹è¯•é¡¹ | æµ‹è¯•å†…å®¹ | é¢„æœŸç»“æœ |
|--------|----------|----------|
| çŠ¶æ€åˆ‡æ¢ | æ‰€æœ‰çŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢ | æ­£ç¡®åˆ‡æ¢ï¼Œæ— å¡æ­» |
| åœºæ™¯åŠ è½½ | å„åœºæ™¯åŠ è½½ | æ­£ç¡®åŠ è½½ï¼Œæ— æŠ¥é”™ |
| æ•°æ®ä¼ é€’ | çŠ¶æ€é—´æ•°æ®ä¼ é€’ | æ•°æ®æ­£ç¡®ä¼ é€’ |
| æš‚åœåŠŸèƒ½ | HOME/MISSIONä¸­æš‚åœ | æ­£ç¡®æš‚åœ/æ¢å¤ |
| å¼‚å¸¸å¤„ç† | åŠ è½½å¤±è´¥ç­‰å¼‚å¸¸ | ä¼˜é›…å¤„ç†ï¼Œä¸å´©æºƒ |

### 7.2 æ€§èƒ½æµ‹è¯•

| æµ‹è¯•é¡¹ | æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|--------|------|--------|
| çŠ¶æ€åˆ‡æ¢æ—¶é—´ | åˆ‡æ¢è€—æ—¶ | < 100ms |
| åœºæ™¯åŠ è½½æ—¶é—´ | åŠ è½½è€—æ—¶ | < 3s |
| å†…å­˜å ç”¨ | åˆ‡æ¢åå†…å­˜ | æ— æ˜æ˜¾æ³„æ¼ |

---

## å…«ã€è®¾è®¡å†³ç­–

| åºå· | é—®é¢˜ | å†³ç­– | è¯´æ˜ |
|------|------|------|------|
| 1 | æ˜¯å¦éœ€è¦å¤šå­˜æ¡£æ§½ä½ï¼Ÿ | **ä¸æ”¯æŒ** | å•å­˜æ¡£è®¾è®¡ï¼Œç®€åŒ–ç³»ç»Ÿ |
| 2 | å‰¯æœ¬ä¸­æ–­/å´©æºƒå¦‚ä½•å¤„ç†ï¼Ÿ | **ä¸¢å¤±å‰¯æœ¬è¿›åº¦** | å´©æºƒåè¿”å›å®¶å›­ï¼Œå‰¯æœ¬ç‰©èµ„ä¸¢å¤±ï¼Œè‹±é›„è½»ä¼¤ |
| 3 | æ˜¯å¦æ”¯æŒè·³è¿‡å¯åŠ¨åŠ¨ç”»ï¼Ÿ | **æ”¯æŒ** | æŒ‰ä»»æ„é”®è·³è¿‡å¯åŠ¨Logo |

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*  
*åˆ›å»ºæ—¥æœŸï¼š2025-12-02*  
*å…³è”æ–‡æ¡£ï¼šæ¸¸æˆç­–åˆ’æ¡ˆ.mdã€ç³»ç»Ÿå¼€å‘æ¸…å•.md*
