# 核心游戏循环系统策划案

> **文档编号**：SYS-001  
> **系统名称**：核心游戏循环系统  
> **所属项目**：《深渊猎手》  
> **文档状态**：初稿  

---

## 📋 文档日志

| 版本 | 日期 | 作者 | 修改内容 |
|------|------|------|----------|
| v1.0 | 2025-11-29 | 策划 | 初稿创建，完成基础框架 |
| - | - | - | 待更新 |

---

## 一、内容说明

### 1.1 系统概述

核心游戏循环系统是《深渊猎手》的基础框架系统，定义了玩家在游戏中的主要行为流程和状态转换。该系统将游戏分为两个主要循环：

- **大循环（Meta Loop）**：公会经营 → 出击准备 → 深渊探索 → 结算返回
- **小循环（Core Loop）**：搜索物资 → 战斗交战 → 撤离逃生

### 1.2 设计目标

| 目标 | 说明 |
|------|------|
| 清晰的游戏节奏 | 玩家清楚知道"现在该做什么" |
| 有意义的决策 | 每个阶段都有值得思考的选择 |
| 风险与收益平衡 | 贪婪与安全的持续博弈 |
| 正向反馈循环 | 成功撤离带来成就感和奖励 |
| 失败可接受 | 失败有惩罚但不会完全归零 |

### 1.3 系统边界

**本系统包含：**
- 游戏阶段定义与切换
- 阶段内基础规则
- 状态机管理
- 流程控制

**本系统不包含（由其他系统负责）：**
- 具体战斗逻辑（战斗系统）
- 物品管理细节（物资系统）
- 角色属性计算（属性系统）
- UI具体表现（UI系统）

---

## 二、系统详细设计

### 2.1 游戏状态机

```
┌─────────────────────────────────────────────────────────────────┐
│                        游戏主状态机                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    ┌──────────┐      ┌──────────┐      ┌──────────┐           │
│    │  启动态  │ ───→ │  公会态  │ ←──→ │  准备态  │           │
│    │  BOOT   │      │  GUILD  │      │  PREP   │           │
│    └──────────┘      └────┬─────┘      └────┬─────┘           │
│                           │                 │                  │
│                           │                 ↓                  │
│                           │           ┌──────────┐            │
│                           │           │  加载态  │            │
│                           │           │ LOADING │            │
│                           │           └────┬─────┘            │
│                           │                │                  │
│                           │                ↓                  │
│                      ┌────┴─────┐    ┌──────────┐            │
│                      │  结算态  │ ←── │  探索态  │            │
│                      │ SETTLE  │    │ EXPLORE │            │
│                      └──────────┘    └──────────┘            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 状态详细说明

#### 2.2.1 启动态（BOOT）

| 属性 | 说明 |
|------|------|
| 状态ID | STATE_BOOT |
| 进入条件 | 游戏启动 |
| 退出条件 | 加载完成 |
| 主要行为 | 加载游戏资源、读取存档、初始化系统 |
| 下一状态 | 公会态 |

```
启动态流程：
1. 显示启动画面
2. 加载核心资源
3. 检测存档
   ├── 有存档 → 读取存档数据
   └── 无存档 → 创建新存档，进入新手引导
4. 初始化各子系统
5. 切换到公会态
```

#### 2.2.2 公会态（GUILD）

| 属性 | 说明 |
|------|------|
| 状态ID | STATE_GUILD |
| 进入条件 | 启动完成 / 结算完成 |
| 退出条件 | 点击出击准备 / 退出游戏 |
| 主要行为 | 公会内所有管理活动 |
| 下一状态 | 准备态 |

```
公会态可进行的操作：
├── 猎手管理
│   ├── 查看猎手列表
│   ├── 猎手详情/装备
│   ├── 技能配置
│   └── 训练/休息
├── 仓库管理
│   ├── 整理物品
│   ├── 装备对比
│   └── 物品分解
├── 设施交互
│   ├── 铁匠铺（制作/强化）
│   ├── 炼金室（制作药水）
│   ├── 医疗室（治疗/复活）
│   └── 其他设施
├── 商店交易
│   ├── 购买物品
│   └── 出售物品
├── 任务系统
│   ├── 查看任务
│   ├── 接取任务
│   └── 提交任务
└── 系统功能
    ├── 设置
    ├── 存档
    └── 退出
```

#### 2.2.3 准备态（PREP）

| 属性 | 说明 |
|------|------|
| 状态ID | STATE_PREP |
| 进入条件 | 从公会态点击"出击准备" |
| 退出条件 | 确认出击 / 返回公会 |
| 主要行为 | 选择猎手、配置装备、选择区域 |
| 下一状态 | 加载态 / 公会态 |

```
准备态流程：
┌─────────────────────────────────────────────────────────────┐
│  第一步：选择猎手                                            │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │
│  │ 猎手A   │ │ 猎手B   │ │ 猎手C   │ │ 猎手D   │          │
│  │ Lv.15  │ │ Lv.12  │ │ Lv.8   │ │ Lv.20  │          │
│  │ 剑士    │ │ 法师    │ │ 游侠    │ │ 牧师    │          │
│  │ [选择] │ │ [受伤] │ │ [选择] │ │ [选择] │          │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  第二步：配置装备                                            │
│  ┌─────────────────┐  ┌─────────────────────────────────┐  │
│  │    猎手形象     │  │  装备槽位                        │  │
│  │                 │  │  [武器] [头盔] [胸甲]           │  │
│  │    ┌─────┐     │  │  [护手] [腿甲] [鞋子]           │  │
│  │    │     │     │  │  [戒指] [项链] [背包]           │  │
│  │    │     │     │  ├─────────────────────────────────┤  │
│  │    └─────┘     │  │  消耗品快捷栏                    │  │
│  │                 │  │  [药水1] [药水2] [卷轴] [空]    │  │
│  └─────────────────┘  └─────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  第三步：选择区域                                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │ 遗忘墓穴    │ │ 腐朽森林    │ │ 废弃矿坑    │          │
│  │ 难度：★☆☆ │ │ 难度：★★☆ │ │ 难度：★★☆ │          │
│  │ 推荐Lv:1-10│ │ 推荐Lv:8-18│ │ 推荐Lv:8-18│          │
│  │ [已解锁]   │ │ [已解锁]   │ │ [未解锁]   │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  第四步：确认出击                                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  出击确认                                            │   │
│  │  猎手：[剑士] 艾伦 Lv.15                             │   │
│  │  区域：遗忘墓穴                                      │   │
│  │  装备价值：约 5,000 金币                             │   │
│  │  ⚠️ 警告：死亡将丢失所有携带物品                     │   │
│  │                                                      │   │
│  │  [返回修改]              [确认出击]                  │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2.4 加载态（LOADING）

| 属性 | 说明 |
|------|------|
| 状态ID | STATE_LOADING |
| 进入条件 | 准备态确认出击 |
| 退出条件 | 加载完成 |
| 主要行为 | 加载区域资源、生成地图、初始化敌人 |
| 下一状态 | 探索态 |

```
加载态流程：
1. 显示加载界面（区域相关的提示/背景）
2. 加载区域资源
3. 生成/加载地图数据
4. 生成敌人配置
5. 初始化撤离点
6. 设置玩家出生点
7. 切换到探索态
```

#### 2.2.5 探索态（EXPLORE）

| 属性 | 说明 |
|------|------|
| 状态ID | STATE_EXPLORE |
| 进入条件 | 加载完成 |
| 退出条件 | 成功撤离 / 猎手死亡 / 强制退出 |
| 主要行为 | 探索、战斗、搜刮、撤离 |
| 下一状态 | 结算态 |

```
探索态子状态机：
┌─────────────────────────────────────────────────────────────┐
│                      探索态子状态                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌──────────┐    遭遇敌人    ┌──────────┐                │
│   │  探索中  │ ─────────────→ │  战斗中  │                │
│   │ ROAMING │ ←───────────── │ COMBAT  │                │
│   └────┬─────┘   战斗结束    └────┬─────┘                │
│        │                          │                        │
│        │ 到达撤离点               │ 死亡                   │
│        ↓                          ↓                        │
│   ┌──────────┐              ┌──────────┐                  │
│   │  撤离中  │              │  死亡    │                  │
│   │EVACUATE │              │  DEAD   │                  │
│   └────┬─────┘              └────┬─────┘                  │
│        │                          │                        │
│        │ 撤离完成                 │                        │
│        ↓                          ↓                        │
│   ┌──────────────────────────────────┐                    │
│   │           退出探索态              │                    │
│   │         进入结算态               │                    │
│   └──────────────────────────────────┘                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**探索态核心规则：**

| 规则 | 说明 |
|------|------|
| 侵蚀度 | 每分钟+5%，到100%猎手死亡 |
| 时间限制 | 最长45分钟（侵蚀度100%时约20分钟） |
| 暂停 | 单机可暂停，暂停时侵蚀度暂停 |
| 撤离 | 需要在撤离点完成撤离仪式 |

#### 2.2.6 结算态（SETTLE）

| 属性 | 说明 |
|------|------|
| 状态ID | STATE_SETTLE |
| 进入条件 | 探索态结束（撤离/死亡） |
| 退出条件 | 点击确认返回 |
| 主要行为 | 展示结果、计算奖励、更新数据 |
| 下一状态 | 公会态 |

```
结算态流程：

【成功撤离结算】
┌─────────────────────────────────────────────────────────────┐
│                    ✓ 撤离成功！                             │
├─────────────────────────────────────────────────────────────┤
│  猎手：艾伦（剑士）                                          │
│  区域：遗忘墓穴                                              │
│  探索时间：12分34秒                                          │
├─────────────────────────────────────────────────────────────┤
│  【战斗统计】                                                │
│  击杀数：23        精英击杀：2        受到伤害：450          │
├─────────────────────────────────────────────────────────────┤
│  【获得物资】                                                │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐             │
│  │骨头x15 │ │皮革x8  │ │铁剑    │ │金币x320│             │
│  └────────┘ └────────┘ └────────┘ └────────┘             │
│  物资总价值：约 1,850 金币                                   │
├─────────────────────────────────────────────────────────────┤
│  【经验获得】                                                │
│  猎手经验：+450 EXP                                          │
│  技能熟练度：剑术+12  格挡+8                                 │
├─────────────────────────────────────────────────────────────┤
│                    [确认返回公会]                            │
└─────────────────────────────────────────────────────────────┘

【死亡结算】
┌─────────────────────────────────────────────────────────────┐
│                    ✗ 猎手阵亡                               │
├─────────────────────────────────────────────────────────────┤
│  猎手：艾伦（剑士）Lv.15                                     │
│  死因：被骷髅王击杀                                          │
│  区域：遗忘墓穴                                              │
├─────────────────────────────────────────────────────────────┤
│  【损失物品】                                                │
│  武器：精钢长剑 (价值1,200)                                  │
│  护甲：锁子甲 (价值800)                                      │
│  背包物品：骨头x10、药水x3...                                │
│  总损失：约 3,500 金币                                       │
├─────────────────────────────────────────────────────────────┤
│  【猎手状态】                                                │
│  ⚰️ 艾伦已死亡                                               │
│                                                             │
│  [永久死亡]     [复活(需要：5000金币+复活药剂)]             │
├─────────────────────────────────────────────────────────────┤
│                    [返回公会]                                │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 小循环详解（搜-打-撤）

#### 2.3.1 搜（Search）

**定义**：在区域中探索地图、搜索容器、收集物资的行为。

| 要素 | 说明 |
|------|------|
| 可搜索对象 | 宝箱、柜子、木桶、尸体、隐藏点 |
| 搜索时间 | 1-3秒不等（根据容器类型） |
| 搜索中断 | 受到攻击会中断搜索 |
| 搜索提示 | 可搜索物体有高亮提示 |

```
搜索流程：
1. 玩家靠近可搜索对象
2. 显示交互提示（按E搜索）
3. 按键开始搜索（播放搜索动画）
4. 搜索完成，显示物品列表
5. 玩家选择拾取物品
6. 物品进入背包（检查容量）
```

#### 2.3.2 打（Strike）

**定义**：与区域中的敌人进行ARPG式战斗。

| 要素 | 说明 |
|------|------|
| 战斗触发 | 进入敌人警戒范围 / 主动攻击 |
| 战斗状态 | 进入战斗后UI变化、BGM切换 |
| 战斗结束 | 敌人全灭 / 脱离战斗范围 |
| 掉落物 | 敌人死亡后在地上生成掉落物 |

```
战斗循环：
1. 进入敌人感知范围
2. 敌人进入警戒状态
3. 敌人发现玩家，进入战斗状态
4. 战斗开始
   ├── 玩家操作：移动、攻击、技能、闪避、使用道具
   └── 敌人AI：根据类型执行战斗行为
5. 战斗结束条件
   ├── 敌人死亡 → 生成掉落物
   ├── 玩家死亡 → 进入死亡状态
   └── 玩家逃离 → 敌人追击/放弃
```

#### 2.3.3 撤（Retreat）

**定义**：到达撤离点，完成撤离仪式，安全离开区域。

| 要素 | 说明 |
|------|------|
| 撤离点位置 | 地图上有标记（已发现的撤离点） |
| 撤离条件 | 到达撤离点范围内 |
| 撤离仪式 | 持续10-30秒的等待时间 |
| 仪式中断 | 受到攻击会中断，需要重新开始 |

```
撤离流程：
1. 玩家到达撤离点
2. 显示撤离选项（按F开始撤离）
3. 开始撤离仪式
   ├── 显示倒计时（如15秒）
   ├── 播放撤离特效（传送门/信号弹等）
   └── 期间可被攻击中断
4. 倒计时结束
5. 撤离成功，切换到结算态
```

### 2.4 阶段切换条件汇总

| 当前状态 | 目标状态 | 触发条件 |
|----------|----------|----------|
| BOOT | GUILD | 游戏资源加载完成 |
| GUILD | PREP | 点击"出击准备"按钮 |
| PREP | GUILD | 点击"返回"按钮 |
| PREP | LOADING | 点击"确认出击"按钮 |
| LOADING | EXPLORE | 区域资源加载完成 |
| EXPLORE | SETTLE | 成功撤离 |
| EXPLORE | SETTLE | 猎手死亡 |
| EXPLORE | SETTLE | 强制退出（丢失进度） |
| SETTLE | GUILD | 点击"返回公会"按钮 |

---

## 三、界面说明

### 3.1 界面列表

| 界面ID | 界面名称 | 所属状态 | 说明 |
|--------|----------|----------|------|
| UI_Boot | 启动界面 | BOOT | Logo、加载进度 |
| UI_Guild_Main | 公会主界面 | GUILD | 公会全景、设施入口 |
| UI_Guild_Hunter | 猎手管理界面 | GUILD | 猎手列表和详情 |
| UI_Guild_Storage | 仓库界面 | GUILD | 物品管理 |
| UI_Guild_Shop | 商店界面 | GUILD | 买卖物品 |
| UI_Guild_Quest | 任务界面 | GUILD | 任务列表 |
| UI_Prep_Hunter | 出击选人界面 | PREP | 选择出击猎手 |
| UI_Prep_Equip | 装备配置界面 | PREP | 装备和消耗品 |
| UI_Prep_Area | 区域选择界面 | PREP | 选择探索区域 |
| UI_Prep_Confirm | 出击确认界面 | PREP | 最终确认 |
| UI_Loading | 加载界面 | LOADING | 加载进度和提示 |
| UI_Explore_HUD | 探索HUD | EXPLORE | 战斗中的信息显示 |
| UI_Explore_Bag | 背包界面 | EXPLORE | 物品管理 |
| UI_Explore_Map | 小地图 | EXPLORE | 区域地图 |
| UI_Explore_Pause | 暂停界面 | EXPLORE | 暂停菜单 |
| UI_Settle_Success | 成功结算界面 | SETTLE | 撤离成功结算 |
| UI_Settle_Fail | 失败结算界面 | SETTLE | 死亡结算 |

### 3.2 核心界面线框图

#### 3.2.1 公会主界面（UI_Guild_Main）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [设置]                                           金币: 12,350  徽章: 5 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                        ┌─────────────────────┐                         │
│     ┌──────┐          │                     │          ┌──────┐       │
│     │铁匠铺│          │      公会大厅       │          │仓库  │       │
│     └──────┘          │      (中央区域)     │          └──────┘       │
│                        │                     │                         │
│     ┌──────┐          │   ┌─────────────┐  │          ┌──────┐       │
│     │炼金室│          │   │ 出击准备    │  │          │商店  │       │
│     └──────┘          │   │   [点击]    │  │          └──────┘       │
│                        │   └─────────────┘  │                         │
│     ┌──────┐          │                     │          ┌──────┐       │
│     │医疗室│          └─────────────────────┘          │任务板│       │
│     └──────┘                                           └──────┘       │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│ 【猎手列表】                                                            │
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐              │
│ │[头像]  │ │[头像]  │ │[头像]  │ │[头像]  │ │  ＋    │              │
│ │艾伦    │ │琳达    │ │马克    │ │苏菲    │ │ 招募   │              │
│ │Lv.15  │ │Lv.12  │ │Lv.8   │ │Lv.20  │ │        │              │
│ │剑士    │ │法师    │ │游侠    │ │牧师    │ │        │              │
│ └────────┘ └────────┘ └────────┘ └────────┘ └────────┘              │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.2 探索HUD（UI_Explore_HUD）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────┐                              ┌─────────────────┐  │
│  │ HP ████████░░░░ │                              │    小地图       │  │
│  │ MP ██████░░░░░░ │                              │   ┌───────┐    │  │
│  │ 耐力 ████████░░ │                              │   │ · ▲ · │    │  │
│  └─────────────────┘                              │   │ · · · │    │  │
│                                                    │   │ · · E │    │  │
│  ┌─────────────────┐                              │   └───────┘    │  │
│  │ 侵蚀度: 35%     │                              │  E=撤离点      │  │
│  │ ████████░░░░░░░ │                              └─────────────────┘  │
│  └─────────────────┘                                                   │
│                                                                         │
│                                                                         │
│                                                                         │
│                          【游戏画面区域】                               │
│                                                                         │
│                                                                         │
│                                                                         │
│                                                                         │
│                                                                         │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐    ┌────────────────────────┐   │
│  │技能1 │ │技能2 │ │技能3 │ │技能4 │    │  [1]药水  [2]药水      │   │
│  │  Q   │ │  W   │ │  E   │ │  R   │    │  [3]卷轴  [4]空        │   │
│  └──────┘ └──────┘ └──────┘ └──────┘    └────────────────────────┘   │
│                                                                         │
│  [TAB]背包    [M]地图    [ESC]暂停                                     │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 3.2.3 结算界面（UI_Settle_Success）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                         ✦ 撤离成功 ✦                                   │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────┐    探索报告                                       │
│  │                 │    ─────────────────────────                      │
│  │    [猎手立绘]   │    猎手：艾伦 (剑士) Lv.15                         │
│  │                 │    区域：遗忘墓穴                                  │
│  │                 │    时间：12:34                                    │
│  │                 │                                                   │
│  └─────────────────┘    战斗统计                                       │
│                         ─────────────────────────                      │
│                         击杀：23  精英：2  Boss：0                      │
│                         受伤：450  使用药水：3                          │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│  获得物品                                                               │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐          │
│  │骨头│ │骨头│ │皮革│ │铁剑│ │戒指│ │金币│ │药水│ │矿石│          │
│  │x10 │ │x5  │ │x8  │ │x1  │ │x1  │ │320 │ │x2  │ │x3  │          │
│  └────┘ └────┘ └────┘ └────┘ └────┘ └────┘ └────┘ └────┘          │
│                                                                         │
│  总价值：约 1,850 金币                                                  │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│  经验获得                                                               │
│  ─────────────────────────────────────────                             │
│  猎手经验：+450 EXP    ████████████████░░░░ (Lv.15 → 72%)             │
│  剑术熟练：+12         格挡熟练：+8                                     │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                        [ 返回公会 ]                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 界面跳转流程

```
                                    ┌──────────────────┐
                                    │    UI_Boot       │
                                    └────────┬─────────┘
                                             │
                                             ↓
┌──────────────────────────────────────────────────────────────────────────┐
│                           UI_Guild_Main                                  │
│                                                                          │
│    ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│    │UI_Hunter │  │UI_Storage│  │ UI_Shop  │  │ UI_Quest │             │
│    └──────────┘  └──────────┘  └──────────┘  └──────────┘             │
│                                                                          │
└─────────────────────────────────┬────────────────────────────────────────┘
                                  │ 点击"出击准备"
                                  ↓
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│  UI_Prep_Hunter ───→ UI_Prep_Equip ───→ UI_Prep_Area ───→ UI_Prep_Confirm│
│                                                                          │
└─────────────────────────────────┬────────────────────────────────────────┘
                                  │ 点击"确认出击"
                                  ↓
                         ┌──────────────────┐
                         │   UI_Loading     │
                         └────────┬─────────┘
                                  │
                                  ↓
                         ┌──────────────────┐
                         │  UI_Explore_HUD  │
                         │  (探索战斗)       │
                         └────────┬─────────┘
                                  │
                    ┌─────────────┴─────────────┐
                    ↓                           ↓
           ┌──────────────────┐       ┌──────────────────┐
           │UI_Settle_Success │       │ UI_Settle_Fail   │
           └────────┬─────────┘       └────────┬─────────┘
                    │                           │
                    └─────────────┬─────────────┘
                                  │
                                  ↓
                         返回 UI_Guild_Main
```

---

## 四、配置表结构

### 4.1 游戏状态配置表（GameState.xlsx）

**表名**：GameState

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| StateID | string | 状态唯一ID | STATE_GUILD |
| StateName | string | 状态名称 | 公会态 |
| AllowPause | bool | 是否允许暂停 | true |
| BGM_ID | string | 背景音乐ID | BGM_Guild_001 |
| DefaultUI | string | 默认打开的UI | UI_Guild_Main |
| OnEnterEvent | string | 进入状态事件 | Event_EnterGuild |
| OnExitEvent | string | 退出状态事件 | Event_ExitGuild |

**示例数据**：

| StateID | StateName | AllowPause | BGM_ID | DefaultUI | OnEnterEvent | OnExitEvent |
|---------|-----------|------------|--------|-----------|--------------|-------------|
| STATE_BOOT | 启动态 | false | BGM_Title | UI_Boot | - | - |
| STATE_GUILD | 公会态 | true | BGM_Guild_001 | UI_Guild_Main | Event_EnterGuild | Event_ExitGuild |
| STATE_PREP | 准备态 | true | BGM_Guild_001 | UI_Prep_Hunter | - | - |
| STATE_LOADING | 加载态 | false | - | UI_Loading | - | - |
| STATE_EXPLORE | 探索态 | true | BGM_Explore_{AreaID} | UI_Explore_HUD | Event_EnterExplore | Event_ExitExplore |
| STATE_SETTLE | 结算态 | false | BGM_Settle | UI_Settle_Success | Event_StartSettle | - |

### 4.2 状态转换配置表（StateTransition.xlsx）

**表名**：StateTransition

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| TransitionID | int | 转换ID | 1001 |
| FromState | string | 起始状态 | STATE_GUILD |
| ToState | string | 目标状态 | STATE_PREP |
| TriggerType | string | 触发类型 | Button/Auto/Event |
| TriggerParam | string | 触发参数 | BTN_StartPrep |
| Condition | string | 前置条件 | HasAliveHunter |
| TransitionTime | float | 过渡时间(秒) | 0.5 |

**示例数据**：

| TransitionID | FromState | ToState | TriggerType | TriggerParam | Condition | TransitionTime |
|--------------|-----------|---------|-------------|--------------|-----------|----------------|
| 1001 | STATE_BOOT | STATE_GUILD | Auto | - | LoadComplete | 0 |
| 1002 | STATE_GUILD | STATE_PREP | Button | BTN_StartPrep | HasAliveHunter | 0.5 |
| 1003 | STATE_PREP | STATE_GUILD | Button | BTN_BackToGuild | - | 0.3 |
| 1004 | STATE_PREP | STATE_LOADING | Button | BTN_ConfirmStart | HunterSelected&AreaSelected | 0 |
| 1005 | STATE_LOADING | STATE_EXPLORE | Auto | - | LoadComplete | 0 |
| 1006 | STATE_EXPLORE | STATE_SETTLE | Event | Event_Evacuate | - | 1.0 |
| 1007 | STATE_EXPLORE | STATE_SETTLE | Event | Event_HunterDead | - | 2.0 |
| 1008 | STATE_SETTLE | STATE_GUILD | Button | BTN_BackToGuild | - | 0.5 |

### 4.3 探索阶段配置表（ExplorePhase.xlsx）

**表名**：ExplorePhase

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| PhaseID | string | 阶段ID | PHASE_SEARCH |
| PhaseName | string | 阶段名称 | 搜索阶段 |
| Description | string | 阶段描述 | 探索地图收集物资 |
| CorrosionRate | float | 侵蚀增长率(/分钟) | 5 |
| AllowActions | string[] | 允许的行为 | Move,Search,Attack |

### 4.4 撤离点配置表（EvacuationPoint.xlsx）

**表名**：EvacuationPoint

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| PointID | int | 撤离点ID | 1 |
| PointType | string | 撤离点类型 | Fixed/Random/Paid/Emergency |
| AreaID | string | 所属区域 | AREA_Tomb |
| Position | Vector3 | 位置坐标 | (100, 0, 50) |
| EvacTime | float | 撤离时间(秒) | 15 |
| Cost | int | 消耗(仅Paid类型) | 500 |
| IsActive | bool | 是否默认激活 | true |

**示例数据**：

| PointID | PointType | AreaID | Position | EvacTime | Cost | IsActive |
|---------|-----------|--------|----------|----------|------|----------|
| 1 | Fixed | AREA_Tomb | (100,0,50) | 15 | 0 | true |
| 2 | Fixed | AREA_Tomb | (200,0,180) | 15 | 0 | true |
| 3 | Paid | AREA_Tomb | (150,0,100) | 10 | 500 | true |
| 4 | Emergency | AREA_Tomb | (0,0,0) | 5 | 0 | true |

### 4.5 结算配置表（SettleConfig.xlsx）

**表名**：SettleConfig

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| ResultType | string | 结算类型 | Success/Death |
| BaseExpRate | float | 基础经验倍率 | 1.0 |
| KillExpBonus | int | 每击杀经验 | 10 |
| EliteExpBonus | int | 精英击杀经验 | 50 |
| BossExpBonus | int | Boss击杀经验 | 200 |
| ItemKeepRate | float | 物品保留率 | 1.0/0 |
| EquipKeepRate | float | 装备保留率 | 1.0/0 |
| DeathPenalty | string | 死亡惩罚 | LoseAllItems |

**示例数据**：

| ResultType | BaseExpRate | KillExpBonus | EliteExpBonus | BossExpBonus | ItemKeepRate | EquipKeepRate | DeathPenalty |
|------------|-------------|--------------|---------------|--------------|--------------|---------------|--------------|
| Success | 1.0 | 10 | 50 | 200 | 1.0 | 1.0 | - |
| Death | 0.3 | 5 | 20 | 100 | 0 | 0 | LoseAllItems |

---

## 五、美术需求

### 5.1 场景美术需求

#### 5.1.1 公会场景

| 资源名称 | 类型 | 规格 | 说明 | 优先级 |
|----------|------|------|------|--------|
| Guild_Main | 场景 | 2D/3D | 公会主场景，包含各设施入口 | P0 |
| Guild_Blacksmith | 场景/区域 | - | 铁匠铺内部 | P1 |
| Guild_Alchemy | 场景/区域 | - | 炼金室内部 | P1 |
| Guild_Medical | 场景/区域 | - | 医疗室内部 | P1 |
| Guild_Storage | 场景/区域 | - | 仓库内部 | P1 |
| Guild_Training | 场景/区域 | - | 训练场 | P2 |

**公会场景风格参考**：
- 温暖的中世纪奇幻风格
- 木质结构为主，有火把/壁炉照明
- 各设施有明显的视觉区分
- 整体氛围：温馨、安全、"家"的感觉

#### 5.1.2 探索区域场景

| 资源名称 | 类型 | 风格 | 说明 | 优先级 |
|----------|------|------|------|--------|
| Area_Tomb | 场景 | 阴暗、灰绿色调 | 遗忘墓穴 | P0 |
| Area_Forest | 场景 | 诡异、墨绿紫黑 | 腐朽森林 | P1 |
| Area_Mine | 场景 | 压抑、土黄橙红 | 废弃矿坑 | P1 |
| Area_Temple | 场景 | 神秘、金黑色调 | 沉沦神殿 | P2 |
| Area_Rift | 场景 | 恐怖、红黑岩浆 | 恶魔裂隙 | P2 |

### 5.2 UI美术需求

#### 5.2.1 界面背景

| 资源名称 | 尺寸 | 说明 | 优先级 |
|----------|------|------|--------|
| UI_BG_Guild | 1920x1080 | 公会界面背景 | P0 |
| UI_BG_Prep | 1920x1080 | 准备界面背景 | P0 |
| UI_BG_Loading | 1920x1080 | 加载界面背景（多套） | P0 |
| UI_BG_Settle_Success | 1920x1080 | 成功结算背景 | P0 |
| UI_BG_Settle_Fail | 1920x1080 | 失败结算背景 | P0 |

#### 5.2.2 UI组件

| 资源名称 | 规格 | 说明 | 优先级 |
|----------|------|------|--------|
| UI_Panel_Common | 可九宫 | 通用面板底图 | P0 |
| UI_Button_Normal | 200x60 | 通用按钮（普通/悬停/按下/禁用） | P0 |
| UI_Button_Confirm | 200x60 | 确认按钮（绿色系） | P0 |
| UI_Button_Cancel | 200x60 | 取消按钮（红色系） | P0 |
| UI_ProgressBar_HP | 可拉伸 | 血条 | P0 |
| UI_ProgressBar_MP | 可拉伸 | 蓝条 | P0 |
| UI_ProgressBar_Corrosion | 可拉伸 | 侵蚀度条（紫色系） | P0 |
| UI_ProgressBar_EXP | 可拉伸 | 经验条 | P1 |
| UI_Slot_Item | 64x64 | 物品格子 | P0 |
| UI_Slot_Skill | 64x64 | 技能格子 | P0 |
| UI_Slot_Equipment | 80x80 | 装备格子 | P0 |
| UI_Frame_Hunter | 120x160 | 猎手卡片边框（按品质分色） | P0 |
| UI_Frame_Area | 200x150 | 区域选择卡片边框 | P0 |

#### 5.2.3 图标需求

| 类型 | 数量 | 规格 | 说明 | 优先级 |
|------|------|------|------|--------|
| 设施图标 | 10+ | 64x64 | 各公会设施的图标 | P0 |
| 状态图标 | 20+ | 32x32 | Buff/Debuff图标 | P1 |
| 属性图标 | 10 | 32x32 | 力量/敏捷/智力等 | P0 |
| 货币图标 | 3 | 32x32 | 金币/灵魂碎片/徽章 | P0 |
| 功能图标 | 15+ | 48x48 | 背包/地图/设置等 | P0 |

### 5.3 特效需求

| 特效名称 | 类型 | 说明 | 优先级 |
|----------|------|------|--------|
| FX_Evacuate | 循环 | 撤离点特效（传送门） | P0 |
| FX_Evacuating | 持续 | 撤离中特效（玩家身上） | P0 |
| FX_Evacuate_Success | 单次 | 撤离成功闪光 | P0 |
| FX_Corrosion | 循环 | 侵蚀度高时的屏幕效果 | P1 |
| FX_LevelUp | 单次 | 升级特效 | P1 |
| FX_ItemDrop | 单次 | 物品掉落特效 | P0 |
| FX_Search | 持续 | 搜索中特效 | P1 |
| FX_AreaTransition | 单次 | 场景切换过渡 | P0 |

### 5.4 动画需求

| 动画名称 | 类型 | 说明 | 优先级 |
|----------|------|------|--------|
| Anim_Hunter_Idle | 循环 | 猎手待机动画 | P0 |
| Anim_Hunter_Search | 单次 | 搜索动画 | P0 |
| Anim_Hunter_Evacuate | 循环 | 撤离等待动画 | P0 |
| Anim_UI_Transition | 单次 | UI切换动画 | P1 |
| Anim_Settle_Success | 单次 | 结算成功动画 | P1 |
| Anim_Settle_Fail | 单次 | 结算失败动画 | P1 |
| Anim_Loading | 循环 | 加载动画 | P0 |

### 5.5 音频需求

#### 5.5.1 背景音乐

| 音乐ID | 场景 | 风格 | 时长 | 优先级 |
|--------|------|------|------|--------|
| BGM_Title | 启动界面 | 史诗/神秘 | 2-3分钟 | P0 |
| BGM_Guild_001 | 公会 | 温暖/放松 | 3-4分钟 | P0 |
| BGM_Explore_Tomb | 遗忘墓穴 | 阴森/紧张 | 3-4分钟 | P0 |
| BGM_Explore_Forest | 腐朽森林 | 诡异/神秘 | 3-4分钟 | P1 |
| BGM_Combat_Normal | 普通战斗 | 紧张/激烈 | 2-3分钟 | P0 |
| BGM_Combat_Boss | Boss战斗 | 史诗/压迫 | 3-4分钟 | P1 |
| BGM_Settle_Success | 成功结算 | 欢快/成就感 | 1分钟 | P0 |
| BGM_Settle_Fail | 失败结算 | 悲伤/低沉 | 1分钟 | P0 |

#### 5.5.2 音效

| 音效ID | 触发 | 说明 | 优先级 |
|--------|------|------|--------|
| SFX_UI_Click | UI点击 | 按钮点击音 | P0 |
| SFX_UI_Open | 界面打开 | 面板打开音 | P0 |
| SFX_UI_Close | 界面关闭 | 面板关闭音 | P0 |
| SFX_Item_Pickup | 拾取物品 | 拾取音效 | P0 |
| SFX_Search_Start | 开始搜索 | 搜索开始音 | P0 |
| SFX_Search_Complete | 搜索完成 | 搜索完成音 | P0 |
| SFX_Evacuate_Start | 开始撤离 | 撤离开始音 | P0 |
| SFX_Evacuate_Tick | 撤离倒计时 | 倒计时滴答声 | P0 |
| SFX_Evacuate_Success | 撤离成功 | 成功音效 | P0 |
| SFX_Corrosion_Warning | 侵蚀度警告 | 警告音 | P0 |
| SFX_Death | 猎手死亡 | 死亡音效 | P0 |

---

## 六、技术实现要点

### 6.1 状态机实现

```
// 伪代码示例
class GameStateManager {
    GameState currentState;
    
    void ChangeState(GameState newState) {
        // 1. 检查转换条件
        if (!CanTransition(currentState, newState)) return;
        
        // 2. 执行退出逻辑
        currentState.OnExit();
        
        // 3. 播放过渡效果
        PlayTransition(currentState, newState);
        
        // 4. 执行进入逻辑
        newState.OnEnter();
        
        // 5. 更新当前状态
        currentState = newState;
    }
}
```

### 6.2 存档时机

| 时机 | 自动存档 | 说明 |
|------|----------|------|
| 进入公会态 | ✓ | 从结算返回时保存 |
| 完成交易 | ✓ | 买卖物品后保存 |
| 装备变更 | ✓ | 更换装备后保存 |
| 设施升级 | ✓ | 升级完成后保存 |
| 探索中 | ✗ | 探索过程不存档，防止SL |
| 手动存档 | ✓ | 仅在公会态可用 |

### 6.3 性能考虑

| 阶段 | 考虑点 | 处理方式 |
|------|--------|----------|
| 加载态 | 大量资源加载 | 异步加载 + 加载进度显示 |
| 探索态 | 敌人/物品管理 | 对象池 + 视野剔除 |
| 结算态 | 大量数据计算 | 分帧处理 |

---

## 七、待确认事项

| 序号 | 问题 | 影响范围 | 状态 |
|------|------|----------|------|
| 1 | 探索态是否支持多人？ | 状态机、网络 | 待定 |
| 2 | 撤离时间是否随区域难度变化？ | 配置表 | 待定 |
| 3 | 侵蚀度是否有上限提升道具？ | 数值、物品 | 待定 |
| 4 | 强制退出探索的惩罚？ | 结算逻辑 | 待定 |

---

## 八、附录

### 8.1 术语表

| 术语 | 说明 |
|------|------|
| 大循环 | Meta Loop，游戏的宏观循环（公会→探索→公会） |
| 小循环 | Core Loop，探索中的核心循环（搜→打→撤） |
| 状态机 | 管理游戏各阶段的系统 |
| 侵蚀度 | 限制探索时间的机制 |
| 撤离点 | 玩家安全离开探索区域的地点 |

### 8.2 参考文档

| 文档名称 | 关联内容 |
|----------|----------|
| 游戏策划案.md | 整体游戏设计 |
| 系统详解文档.md | 各系统说明 |
| 战斗系统策划案.md | 战斗相关（待创建） |
| 物资系统策划案.md | 物品相关（待创建） |

---

*文档版本：v1.0*  
*创建日期：2025-11-29*  
*最后更新：2025-11-29*
